(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{205:function(t,a,e){"use strict";e.r(a);var v=e(0),_=Object(v.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"分布式链路日志组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分布式链路日志组件"}},[t._v("#")]),t._v(" 分布式链路日志组件")]),t._v(" "),e("p",[e("code",[t._v("MinBox Logging")]),t._v("是一款分布式、零侵入式的链路日志分析框架，支持"),e("code",[t._v("SpringCloud")]),t._v("微服务架构下配置使用，内部封装了"),e("code",[t._v("RestTemplate")]),t._v("、"),e("code",[t._v("OpenFeign")]),t._v("两种方式透传链路信息。")]),t._v(" "),e("h2",{attrs:{id:"零侵入式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#零侵入式"}},[t._v("#")]),t._v(" 零侵入式")]),t._v(" "),e("p",[e("code",[t._v("MinBox Logging")]),t._v("无需使用注解配置采集链路日志，只需要添加"),e("code",[t._v("依赖")]),t._v("后简单配置"),e("code",[t._v("Minbox Loggin Admin")]),t._v("的相关"),e("code",[t._v("地址")]),t._v("或"),e("code",[t._v("服务名称")]),t._v("即可，每次在收到请求时就会把请求对应的链路日志详细信息自动上报到"),e("code",[t._v("MinBox Logging Admin")]),t._v("进行后续分析、告警通知等。")]),t._v(" "),e("h2",{attrs:{id:"链路日志分析图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#链路日志分析图"}},[t._v("#")]),t._v(" 链路日志分析图")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://apiboot.minbox.io/img/logging/minbox-logging-trace.png",alt:""}})]),t._v(" "),e("h2",{attrs:{id:"日志客户端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志客户端"}},[t._v("#")]),t._v(" 日志客户端")]),t._v(" "),e("p",[e("code",[t._v("链路日志")]),t._v("的采集端，也就是具体的业务服务，只需要添加"),e("code",[t._v("minbox-logging-client")]),t._v("客户端进行简单的配置就可以实现日志的采集以及日志的异步上报。")]),t._v(" "),e("h2",{attrs:{id:"日志管理端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志管理端"}},[t._v("#")]),t._v(" 日志管理端")]),t._v(" "),e("p",[t._v("对外提供"),e("code",[t._v("安全的日志上报")]),t._v("功能，通过整合"),e("code",[t._v("Spring Security")]),t._v("来完成"),e("code",[t._v("Basic Auth")]),t._v("基础认证，管理端接收到采集端上报的日志后会自动将日志存储到数据库，考虑到扩展方便，同样也提供监听"),e("code",[t._v("日志上报事件(ReportLogEvent)")]),t._v("的方式来自定义存储日志到"),e("code",[t._v("消息队列")]),t._v("、"),e("code",[t._v("logstash")]),t._v("、"),e("code",[t._v("文件")]),t._v("等存储介质。")]),t._v(" "),e("h2",{attrs:{id:"日志管理界面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志管理界面"}},[t._v("#")]),t._v(" 日志管理界面")]),t._v(" "),e("p",[e("code",[t._v("MinBox Logging Admin")]),t._v("提供了界面管理应用程序，通过"),e("code",[t._v("VUE")]),t._v("前端框架进行编写界面与管理端的接口通讯，实时展示"),e("code",[t._v("链路日志")]),t._v("、"),e("code",[t._v("日志采集服务列表")]),t._v("等信息，可查看每条链路日志的详细信息（包含：请求头、请求参数、响应内容、响应头、状态码、异常堆栈信息等）。")]),t._v(" "),e("h3",{attrs:{id:"整合spring-security后的登录界面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#整合spring-security后的登录界面"}},[t._v("#")]),t._v(" 整合Spring Security后的登录界面")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://apiboot.minbox.io/img/logging/logging-admin-login.png",alt:""}})]),t._v(" "),e("p",[t._v("可以直接整合"),e("code",[t._v("Spring Security")]),t._v("来完成"),e("code",[t._v("Basic")]),t._v("安全认证。")]),t._v(" "),e("h3",{attrs:{id:"上报日志的服务列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#上报日志的服务列表"}},[t._v("#")]),t._v(" 上报日志的服务列表")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://apiboot.minbox.io/img/logging/logging-admin-service.png",alt:""}})]),t._v(" "),e("p",[t._v("请求日志的采集服务在第一次上报时，会自动创建一条服务记录，服务的唯一性是根据："),e("code",[t._v("服务ID")]),t._v(" + "),e("code",[t._v("服务IP")]),t._v(" + "),e("code",[t._v("服务端Port")]),t._v(" 来进行定义。")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),e("p",[t._v("在每次上报日志成功后会修改服务的最后一次上报时间。")])]),t._v(" "),e("h3",{attrs:{id:"链路日志列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#链路日志列表"}},[t._v("#")]),t._v(" 链路日志列表")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://apiboot.minbox.io/img/logging/logging-admin-logs.png",alt:""}})]),t._v(" "),e("p",[t._v("链路日志是我们访问的入口服务生成，比如："),e("code",[t._v("bff-user")]),t._v(" -> "),e("code",[t._v("user-service")]),t._v("，链路日志产生的位置则是"),e("code",[t._v("bff-user")]),t._v("服务，链路日志是接口"),e("code",[t._v("请求的入口")]),t._v("也是做出"),e("code",[t._v("响应的结束位置")]),t._v("，因此我们可以在页面上查看接口的请求"),e("code",[t._v("参数详情")]),t._v("、"),e("code",[t._v("头信息")]),t._v("以及"),e("code",[t._v("响应的内容")]),t._v("，至于链路日志内的"),e("code",[t._v("日志单元")]),t._v("目前界面还未做展示，可以根据"),e("code",[t._v("traceId")]),t._v("链路日志编号自行去数据库查询。")]),t._v(" "),e("h3",{attrs:{id:"链路日志详情"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#链路日志详情"}},[t._v("#")]),t._v(" 链路日志详情")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://apiboot.minbox.io/img/logging/logging-admin-log-detail.png",alt:""}})]),t._v(" "),e("p",[t._v("每一个请求的链路日志都会包含上图中的全部字段，从请求开始 -> 响应结束一条链路闭合记录。")]),t._v(" "),e("h3",{attrs:{id:"安全性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安全性"}},[t._v("#")]),t._v(" 安全性")]),t._v(" "),e("p",[e("code",[t._v("MinBox Logging Admin UI")]),t._v("内部提供了"),e("code",[t._v("login.html")]),t._v("登录页面，可以整合"),e("code",[t._v("Spring Security")]),t._v("通过配置"),e("code",[t._v("loginPageUrl")]),t._v("登录跳转地址来使用内置的登录页面，当然也可以自定义登录页面。")]),t._v(" "),e("p",[t._v("可与"),e("code",[t._v("MinBox Logging Admin")]),t._v("共同使用"),e("code",[t._v("Spring Security")]),t._v("的相同配置提升安全性。")]),t._v(" "),e("h2",{attrs:{id:"源码方式构建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源码方式构建"}},[t._v("#")]),t._v(" 源码方式构建")]),t._v(" "),e("p",[e("code",[t._v("MinBox Logging")]),t._v("使用"),e("code",[t._v("Maven")]),t._v("进行构建项目。")]),t._v(" "),e("h3",{attrs:{id:"先决条件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#先决条件"}},[t._v("#")]),t._v(" 先决条件")]),t._v(" "),e("p",[t._v("源码拉取需使用"),e("code",[t._v("Git")]),t._v("，具体使用方式详见"),e("a",{attrs:{href:"https://help.github.com/en/articles/set-up-git",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装 Git"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("源码采用"),e("code",[t._v("JDK1.8")]),t._v("版本进行编写，请注意修改使用项目的"),e("code",[t._v("JDK")]),t._v("版本，"),e("a",{attrs:{href:"https://www.oracle.com/technetwork/java/javase/downloads/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("JDK 1.8下载地址"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("需本地安装"),e("code",[t._v("Maven")]),t._v("环境，"),e("a",{attrs:{href:"https://maven.apache.org/download.cgi",target:"_blank",rel:"noopener noreferrer"}},[t._v("Maven 下载地址"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("因"),e("code",[t._v("logging-admin-ui")]),t._v("所需"),e("code",[t._v("vue-cli-service")]),t._v("命令支持，本地需要安装"),e("code",[t._v("vue-cli")]),t._v("。")]),t._v(" "),e("h3",{attrs:{id:"拉取源码到本地"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#拉取源码到本地"}},[t._v("#")]),t._v(" 拉取源码到本地")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone git@gitee.com:minbox-projects/minbox-logging.git\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"安装到本地maven仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装到本地maven仓库"}},[t._v("#")]),t._v(" 安装到本地Maven仓库")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("mvn "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"编译-打包生成jar包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编译-打包生成jar包"}},[t._v("#")]),t._v(" 编译 & 打包生成jar包")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("mvn clean package\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h2",{attrs:{id:"开源许可"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开源许可"}},[t._v("#")]),t._v(" 开源许可")]),t._v(" "),e("p",[e("code",[t._v("MinBox Logging")]),t._v("采用"),e("code",[t._v("Apache2")]),t._v("开源许可。")])])}),[],!1,null,null,null);a.default=_.exports}}]);